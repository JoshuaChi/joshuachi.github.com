<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Joshua Chi's Blog</title>
   <meta name="author" content="Joshua Chi" />
   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

		<!-- Google Analytics -->
		<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-9434024-4']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		</script>
		<!-- Google Analytics end -->
</head>
<body>

<div class="site">
  <div class="header">
    <a href="/">Free To Feel</a>
  </div>

<!--start of side bar-->
<div id="sidebar" >
	<img src='http://www.gravatar.com/avatar/81759b36bd906bbf803ce4a5ce84e643.png' />
	<br />
	Joshua Chi
    <div class="contact">
        <a href="http://twitter.com/Joshua_C/">twitter.com/Joshua_C</a><br />
				<a href="https://github.com/joshuachi">My Github</a><br />
				<a href="http://www.dachebang.com">搭车帮</a><br />
				<a href="http://www.kiwitask.com">Find freelancer</a><br />
			</div>
			<div>
				<a href='http://www.freetofeel.com/archives.html'> Archived Posts</a>
			</div>
			<div class="rss">
                                <p><a href="http://feeds.feedburner.com/freetofeel"><img src="http://feeds.feedburner.com/~fc/freetofeel?bg=99CCFF&amp;fg=444444&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a></p>
				<p>
				<a href="http://freetofeel.com/atom.xml">Subscribe(xml)</a>
				</p>
				<p>
				<a href="http://feeds.feedburner.com/FreeToFeel">Subscribe(feedburner)</a>
				</p>
			</div>	
		
			<p class='douban'>
				<script type="text/javascript" src="http://www.douban.com/service/badge/joshua_c/?show=collection&amp;select=random&amp;n=8&amp;columns=2&amp;hidelogo=yes&amp;cat=book|music" ></script> 
				</p>
</div>
<!--end of side bar-->

	<div id='content'>
		<div id="home">

<div class="post">
  <ul class="content">
		
			<div class="post" id="postid-/2012/01/22/dragon-year">
				<h3 class="title"><a href="/2012/01/22/dragon-year.html">年末总结(Dragon Year Wish List)</a></h3>
				
				<p>开始慢慢享受除夕之夜了。最尽意的莫过于总结过去，展望明年。
今年除夕只是飘着小雪，但家乡依然比上海冷。
过去的一年我真的努力尝试去喜欢上海，去适应它。尽管为此我已经付出了代价。2011年，身体状况不佳，这个倒是给我提了一个很大的醒。
2011年10月份开始，着实让我体会到了忙，所有的事情交织在一块，忙的我正事都来不及做了。</p>

<h3>2011 完成的目标</h3>




<ul>
  <li>
    <del>结婚，自己都觉得不好意思了；</del>
  </li>
  <li>
    <del>下半年装修；</del>
  </li>
  <li>
    <del>完成学车；</del>
  </li>
  <li>
    <del>回家把护照给办了；</del>
  </li>
  <li>
    <del>希望可以在工作中做的更多，得到更大的认可。</del>
  </li>
  <li>
    <del>和亲戚朋友多联系，2010年，我们联系的太少了；</del>
  </li>
  <li>
    <del>争取做一次说的过去的远徒旅行或者国外旅行一次 :-)；</del>    
  </li>
  <li>
    <del>多写点有价值的文章</del>    
  </li>
</ul>




<h3>2011 未完成的事情</h3>




<ul>
  <li>
    上线一个新的产品， 如果有精力将其它几个产品打包上线 -- <br />事情多蹉跎，这个是我最想做的事情，在最后的几个月只能被搁置，完成率60%。
  </li>
  <li>
    在互联网上混的更实在，看到这领域太多的肤浅和吹嘘 -- <br />因为第一次定目标，此目标定的太虚。想的没有用实体表达出来，以至目前无法测量。  
  </li>
  <li>
    寻找一种锻炼身体的方式，这个是最急切的任务 -- <br />尝试了去打羽毛球，也确实坚持了半年多，但最后还是级别太低，没能最后坚持下来。  
  </li>
</ul>




<h3>2012 TODO LIST：</h3>




<ul>
  <li>
    强身健体第一位，具体目标是锻炼腰部腹部肌肉，提高身体协调能力。
  </li>
  <li>
    职业发展： <br />
    a. 空间的预测;<br />
    b. 时间的估计，把持重点;<br />
    c. Have a better idea about how to manage team and how to manage company.
  </li>
  <li>
    增加静心休息的时间。
  </li>
  <li>
    买车。
  </li>
  <li>
    读书>=15本；<br />
    电影>=5;<br />
  </li>
  <li>
    完成网站建设，其实现在已经不再是为了完成而完成了。练手；练脑；提高思维的整体性，连续性，可扩展性。
  </li>
  <li>
    蜜月履行。
  </li>
  <li>
    去年的时间管理基本满意，需要继续坚持下来。
  </li>
</ul>




<h3>2012 WISH LIST：</h3>


<p>祝福我，我的家人，我认识的亲戚朋友身体健健康康！</p>


				<div class="post-metadata">
					January 22, 2012 | 
					<a href='/2012/01/22/dragon-year.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#2012'>2012</a>
						, 
					
						
						<a href='/tags.html#newyear'>newyear</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/08/01/mysql-federated-engine">
				<h3 class="title"><a href="/2011/08/01/mysql-federated-engine.html">How And When To Use Mysql Federated Storage Engine</a></h3>
				
				<p>Learned from <a href='http://conferences.oreillynet.com/presentations/mysql06/mixi_update.pdf'>mixi update</a> that they are using mysql federated engine for db partitioning.</p>

<pre>
Use FEDERATED TABLE from MySQL 5.
Or do SELECT twice which is faster than using FEDERATED TABLEs
</pre>


<p><a href='http://dev.mysql.com/doc/refman/5.0/en/federated-storage-engine.html'>Mysql Official document</a> didn't talk too much about how and when to use federated engine. You can learned more from <a href='http://www.xaprb.com/blog/2007/01/29/mysqls-federated-storage-engine-part-1/'>Mysql Federated storage engine 1</a> and <a href='http://www.xaprb.com/blog/2007/01/31/mysqls-federated-storage-engine-part-2/'>Mysql Federated storage engine 2</a>.</p>

<p>Finally I find some clues in <a href='http://www.xaprb.com/blog/2007/01/31/mysqls-federated-storage-engine-part-2/'>Mysql Federated storage engine 2</a>:</p>

<pre>
Strengths:

For example, pretend you have a set of distributed servers working on small parts of a large task, and their results need to be merged back together when done without conflict. Many solutions to this problem involve modulo arithmetic for generating primary keys. This could be a good use of a FEDERATED table: just federate one central table on all the servers, have the processes INSERT into the table, and they’ll get non-conflicting primary key numbers. That’s a trivially easy way to coordinate distributed resource requests.

The way it lets you mis-define tables holds great potential. For example, Giuseppe Maxia has already noted that you can define a FEDERATED table against a view. Views don’t have indexes (yet), but that shouldn’t stop you from telling the engine it does! That way, your WHERE clauses are sent through to the remote server unharmed, where the view can execute GROUP BY queries and the like. Giuseppe even outlines a way to get the remote server to execute arbitrary commands via a FEDERATED table!

What about combinations with replication, triggers and so forth? There must be many more cool hacks waiting to be discovered.

</pre>


<p>And in <a href='http://mysql.lamphost.net/tech-resources/articles/mysql-federated-storage.html'>Accessing Distributed Data with the Federated Storage Engine</a>, you can find a simple demo that 'merge' two partioned tables into one by creating a view. Although, this is not what I expected. It will still make sense in some cases.</p>

<p>Still have some questions about how the performance looks like when use view? And what's the limitation of rows or table size when using federated storage engine?</p>


				<div class="post-metadata">
					August 01, 2011 | 
					<a href='/2011/08/01/mysql-federated-engine.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#mysql'>mysql</a>
						, 
					
						
						<a href='/tags.html#federated'>federated</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/07/26/jquery-ajax-file-upload-with-symfony4">
				<h3 class="title"><a href="/2011/07/26/jquery-ajax-file-upload-with-symfony4.html">Form Ajax Submit With Jquery Form Plugin</a></h3>
				
				<p>I can't remember how I make file ajax upload work last time. So a blog might be the best place to record it.</p>

<p>Because <a href='http://en.wikipedia.org/wiki/Xmlhttprequest'>XMLHttpRequest</a> didn't support file upload, and I didn't want to spend much time to hack it. So it might be simple to find a plugin to do it. I compared several plugins supporting file ajax upload.</p>

<p>At last I choose <a href='http://malsup.com/jquery/form/'>Jquery Form Plugin</a>. Althrough it didn't sound like it supposed to be. Especially there is file field in your form. And the data format that client communicate with server is <a href='http://en.wikipedia.org/wiki/Json'>json</a></p>

<p>So what does it look like?</p>

<p>JS Client:</p>

<pre>
                            var options = {
                                beforeSubmit: function(formData, jqForm, options) { 
                                  var queryString = $.param(formData);
                                    alert('About to submit: \n\n' + queryString); 
                                    
                                    for (var i=0; i < formData.length; i++) { 
                                        if (!formData[i].value) { 
                                          return false; 
                                    } 
                                    } 
                                },
                                success: function(data) {
                                        if(data && typeof data == 'object'){
                                            //...
                                        }
                                },
                url:       '/action', 
                dataType:  'json',
                clearForm: true
              }; 
              
                            $('#form').ajaxSubmit(options);
                          return false; 
</pre>


<p>Symfony Backend:</p>

<pre>

        $json = json_encode($data);
        if(!$request->isXmlHttpRequest()){
          echo '&lt;textarea&gt;'.$json.'&lt;/textarea&gt;';
          return sfView::NONE;
        }else{
        echo $json;
          return sfView::NONE;
        }
</pre>


<p>You can check <a href='http://malsup.com/jquery/form/#file-upload'>plugin document</a> to know why you need 'echo "&lt;textarea&gt;"'.  :-D</p>


				<div class="post-metadata">
					July 26, 2011 | 
					<a href='/2011/07/26/jquery-ajax-file-upload-with-symfony4.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#jquery'>jquery</a>
						, 
					
						
						<a href='/tags.html#file'>file</a>
						, 
					
						
						<a href='/tags.html#symfony'>symfony</a>
						, 
					
						
						<a href='/tags.html#ajax'>ajax</a>
						, 
					
						
						<a href='/tags.html#form'>form</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/07/02/iphone4-network-sharing-under-ubuntu">
				<h3 class="title"><a href="/2011/07/02/iphone4-network-sharing-under-ubuntu.html">Network Sharing Between Ubuntu And IPhone4(China Unicom Contract Version)</a></h3>
				
				<p>Find a solution from Internet that can make network sharing between Ubuntu And IPhone4.</p>

<pre>
sudo add-apt-repository ppa:pmcenery/ppa

sudo apt-get update

sudo apt-get install gvfs ipheth-dkms ipheth-utils
</pre>


<p>If you can pass all these steps, and then restart your machine. Bingo!</p>

<p>You can find more information <a href='http://ivkin.net/2010/05/tethering-ubuntu-lucid-lynx-and-iphone-os/#comment-4790' >here</a>.</p>


				<div class="post-metadata">
					July 02, 2011 | 
					<a href='/2011/07/02/iphone4-network-sharing-under-ubuntu.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#wifi'>wifi</a>
						, 
					
						
						<a href='/tags.html#ubuntu'>ubuntu</a>
						, 
					
						
						<a href='/tags.html#iphone4'>iphone4</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/06/22/get-commit-back-after-git-hard-reset">
				<h3 class="title"><a href="/2011/06/22/get-commit-back-after-git-hard-reset.html">Restore Lost Commits After Git Hard Reset</a></h3>
				
				<p>Sometimes, you will make mistakes. But when someone told you there still is a hope that if you try xxxxx. What feeling will you have?</p>

<p>The following might be one solution after 'git reset --hard' and realized you made a mistake:</p>

<pre>
  $ git reflog
  $ git merge 7c61179
</pre>


<p>Check the blog post <a href='http://gitready.com/advanced/2009/01/17/restoring-lost-commits.html'>here</a>.</p>


				<div class="post-metadata">
					June 22, 2011 | 
					<a href='/2011/06/22/get-commit-back-after-git-hard-reset.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#git'>git</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/06/12/nosql-db-try">
				<h3 class="title"><a href="/2011/06/12/nosql-db-try.html">Replace MySql Table with NoSQL DB</a></h3>
				
				<h4>Backgroud:</h4>


<p>I am not nosql fans. I don't have the habit to replace whole mysql db with nosql db. But if a mysql table can be replaced with nosql db and expensive queries are generated againest this table, I will give a try of nosql DB.</p>

<p>In our product, we have a unique user login log table to know how many users logined in a specify date. Here is the table structure:</p>

<pre>
  unique_login_logs: 
    _attributes:  {phpName: UniqueLoginLog}
    id:
    user_id: { type: integer }
    date: { type: date, index: true }
    created_at:
    _uniques:
      unique_date_type: [user_id, date]
</pre>


<p>The expensive query looks like:</p>

<pre>
select date, count(`user_id`) from unique_login_logs group by date order by date desc;'
</pre>


<p>And the other related operations will be save an entry into this table or check the user entry for a specify date is in the table or not. Nothing more.</p>

<h4>Choose NoSQL DB from <a href='http://en.wikipedia.org/wiki/NoSQL'>wiki page</a>: </h4>




<pre>
...
Key-value cache in RAM

    Citrusleaf database
    memcached
    Oracle Coherence
    Redis
    Tuple space
    Velocity

Key-value stores implementing the Paxos algorithm

    Keyspace

Key-value stores on disk

    BigTable
    CDB
    Citrusleaf database
    Dynomite
    Keyspace
    membase
    Memcachedb
    Redis
    Tokyo Cabinet
    TreapDB
    Tuple space
    MongoDB
...
</pre>


<p>For my feature request, I need a disk stored key-value system. I just spend 1 minute to take a look the MongoDB features. It meet my feature requirements. That's enough. If you know more about the other nosql DBs, of course you should choose the one which suit yours best.</p>

<h4>Try MongoDB</h4>


<p>Step 1: Install MongoDB(http://www.mongodb.org/display/DOCS/Quickstart+Unix);</p>

<p>Step 2: Simple demo testing:</p>

<p>create a new db:</p>

<pre>
use mydb;
</pre>


<p>Save an entry:</p>

<pre>
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 101});
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 111});
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 102});
..
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 100});
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 101});
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 102});
</pre>


<p>Group entries by date:</p>

<pre>
db.uniqueLoginLog.group(
           {key: { date:true },
            reduce: function(obj,prev) { prev.count ++; },
            initial: { count: 0 }
            });
            
</pre>


<p>The output looks like:</p>

<pre>
[
    {
        "date" : "2011-01-01",
        "count" : 3
    },
    {
        "date" : "2011-01-02",
        "count" : 3
    },
    {
        "date" : "2011-01-03",
        "count" : 1
    },
    {
        "date" : "2011-01-04",
        "count" : 1
    }
]
</pre>


<p></p>

<p>With the output, I can do the order in client.</p>

<h4>Install PHP Mongo Extension</h4>


<p>You can install Mongo PHP extension with pecl command line or install it <a href='http://pecl.php.net/package/mongo'>manually</a></p>

<pre>
> pecl search mongo
Retrieving data...0%
Matched packages, channel pecl.php.net:
=======================================
Package Stable/(Latest) Local
mongo   1.1.4 (stable)        MongoDB database driver

> pecl install mongo
</pre>




<h4>Get stored items with php function</h4>


<p>PHP code:</p>

<pre>
$m = new Mongo();

$db = $m->mydb;

$collection = $db->uniqueLoginLog;


$obj = array('date'=> '2011-06-09', 'user_id'=> 101);
$collection->insert($obj);



$keys = array("date" => 1);
$initial = array("count" => 0);
$reduce = "function(obj,prev) { prev.count ++; }";
$g = $collection->group($keys, $initial, $reduce);

var_dump($g);

</pre>


<p>Output looks like:</p>

<pre>
array(4) {
  ["retval"]=>
  array(3) {
    [0]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-09"
      ["count"]=>
      float(17)
    }
    [1]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-11"
      ["count"]=>
      float(10)
    }
    [2]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-10"
      ["count"]=>
      float(7)
    }
  }
  ["count"]=>
  float(34)
  ["keys"]=>
  int(3)
  ["ok"]=>
  float(1)
}
</pre>




<h4>Deploy to production?</h4>


<p>Until now, the demo is still a toy. If you want to deploy it to production, there are more work need to to be done. Take a look at the <a href='http://www.mongodb.org/display/DOCS/Admin+Zone'>admin zone</a></p>

<p>For my feature implemention, I will consider <a href='http://www.mongodb.org/display/DOCS/Replication'>Replication</a> next step.</p>

<p>Summary:</p>

<p>This is not a <a href='http://www.mongodb.org/display/DOCS/Tutorial'>toturial</a> about how to use MongoDB. It is just a example that can use nosql db in your production.</p>

<p>Reference:</p>

<ul>
<li><a href='http://try.mongodb.org/'>A Tiny MongoDB Browser Shell (mini tutorial included)</a></li>
<li><a href='https://github.com/mongodb/mongo/tree/master/jstests/'>JsTest</a></li>
</ul>



				<div class="post-metadata">
					June 12, 2011 | 
					<a href='/2011/06/12/nosql-db-try.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#mysql'>mysql</a>
						, 
					
						
						<a href='/tags.html#nosql'>nosql</a>
						, 
					
						
						<a href='/tags.html#mongodb'>mongodb</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/2011/05/24/mysql-index-merge">
				<h3 class="title"><a href="/2011/05/24/mysql-index-merge.html">When To Use Combine Index</a></h3>
				
				<p>There are already a lot of posts which gave a introduction of what index merge is in MySQL. One of them is:</p>

<p><a href='http://brian.moonspot.net/2008/04/22/playing-with-mysql-index-merge/'>Playing with MySQL's index merge</a></p>

<p>Today I just noticed the combined index also can be affected by the single column index. For example:</p>

<ol>
<li>Let's say we have a table named table1 which have 100,000 items. The size of this table is 35MB.</li>
</ol>


<p>Table structure:</p>

<pre>
CREATE TABLE `table1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `status1` int(11) DEFAULT NULL,
  `status2` int(11) DEFAULT NULL,
  `status3` int(11) DEFAULT NULL,
  `status4` int(11) DEFAULT NULL,
  `status5` int(11) DEFAULT NULL,
  `status6` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `table1_name_unique` (`name`),
  KEY `table1_status1` (`status1`),
  KEY `table1_status2` (`status2`),
  KEY `table1_status3` (`status3`),
  KEY `table1_status4` (`status4`),
  KEY `table1_status5` (`status5`),
  KEY `table1_status6` (`status6`),
  KEY `table1_combine_index` (`status1`,`status2`,`status3`,`status4`,`status5`,`status6``)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</pre>


<p>We have a query need to select items from table1 table with checking all the status columns in where clause. Let's do a explain:</p>

<pre>
explain select * from table1 where status1=1 and status2=1 and status3=1 and status4=1 and status5=1 and status6=1  
</pre>


<p>Explain result:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: index_merge
  possible_keys: PRIMARY,table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6,table1_combine_index
  key: table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6
  key_len: 1,1,4,4,4,5
  refs: NULL
  rows: 1955
  Extra: Using intersect(table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6); Using where
</pre>


<p>The select query takes <b>3.5ms</b> by intersecting indexes.</p>

<p>What happened if we force index to use table1_combine_index:</p>

<pre>
explain select * from table1 force index (table1_combine_index)  where status1=1 and status2=1 and status3=1 and status4=1 and status5=1 and status6=1  
</pre>


<p>Explain result:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: ref
  possible_keys: table1_combine_index
  key: table1_combine_index
  key_len: 9
  refs: const,const
  rows: 62590
  Extra: Using where
</pre>


<p>The select query takes <b>10.5ms</b> by using combine index.</p>

<p>In this example, intersecting index is more useful than combine index. There is an article give a more detailed explanation why it works like this:</p>

<p><a href='http://www.mysqlperformanceblog.com/2009/09/19/multi-column-indexes-vs-index-merge/'>Multi Column indexes vs Index Merge</a></p>

<ol>
<li>Now it's time to make this example a little complicated.</li>
</ol>


<p>We have another table named table2, the structure looks like:</p>

<pre>
CREATE TABLE `table2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `table1_id` int(11) NOT NULL,
  `column1` datetime NOT NULL,
  `column2` varchar(255) NOT NULL,
  `column3` text,
  `column4` tinyint(4) NOT NULL,
  `column5 ` tinyint(4) NOT NULL,
  `column6 ` tinyint(4) NOT NULL,
  `column7` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `column7 ` (`column7 `),
  KEY `table2_FI_1` (`table1_id `)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</pre>


<p>There are 20,000 rows in table2, with size 11MB. We have a feature request need to join table1 with table2 and sort by table2's id.</p>

<pre>
SELECT sql_no_cache * FROM table2 LEFT JOIN table1 ON (table2.table1_id = table1.id) WHERE table1.status1=1 and table1.status2=1 and table1.status3=1 and table1.status4=1 and table1.status5=1 and table1.status6=1 ORDER BY table2.id DESC LIMIT 10;
</pre>


<p>It takes <b>3s</b> to finish the query. The explain tells you:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: index_merge
  possible_keys: PRIMARY,`table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`,`table1_combine_index`
  key: `table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`
  key_len: 1,1,4,4,4,5
  refs: NULL
  rows: 1955
  Extra: Using intersect(`table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`); Using where
  
  ---
  select_type: SIMPLE
  table: table2
  type: ref
  possible_keys: table2_FI_1
  key: table2_FI_1
  key_len: 4
  refs: table1.id
  rows: 1
  Extra:  
</pre>


<p>Now I want to remove these single column indexes in table1 to see what will happen:</p>

<pre>
  select_type: SIMPLE
  table: table2
  type: index
  possible_keys: table2_FI_1
  key: PRIMARY
  key_len: 4
  refs: 
  rows: 10
  Extra:
  
  ---
  
  select_type: SIMPLE
  table: table1
  type: eq_ref
  possible_keys: PRIMARY,table1_combine_index
  key: PRIMARY
  key_len: 4
  refs: table2.table1_id
  rows: 1
  Extra: Using where
</pre>


<p>After removing the single column indexes in table 1, this select query only takes <b>2.4ms</b>. To explain this, we can simply treat (status1,status2,status3,status4,status5,status6) as one column in table1. I think the single columns indexes affected the 'join' performance. MySQL need to use these single indexes to filter the table1 firstly and then make a join with table2.</p>

<p>Summary:</p>

<p>Combine index is not always better than index merge. To know which one is better, explain your query, analyze it and adjust the index.</p>


				<div class="post-metadata">
					May 24, 2011 | 
					<a href='/2011/05/24/mysql-index-merge.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#mysql'>mysql</a>
						
					 
				</div>

			</div>
		
		
		<div class="paging">
		
			<a href="/page3" class="previous">&#x25C4; Previous</a>
		
		
			
			  <a href="/" class="next">Next &#x25BA;</a>
			
		
		</div>

  </ul>
</div>
</div>

	</div>
  
  <div class="footer">
		<div id="copyright">
			Copyright &copy; 2011 Joshua Chi - Powered by <a href="http://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://github.com/">Github</a>
		</div>
  </div>    
</div>

</body>
</html>
