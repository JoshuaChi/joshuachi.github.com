<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
  
    <meta name="description" content="Heading to entrepreneur." />
  
  
  
    <meta name="keywords" content="technical, entrepreneur, consulting, blog, personal, life, work, freelancer" />
  
  
  
  
  <meta name="robots" content="INDEX,FOLLOW" />

  <title>
    Joshua Chi's Blog &middot; Free To Feel
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/webicon.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="http://freetofeel.com">Free To Feel</a></h1>
        <p class="lead">Heading to entrepreneur.</p>
        <br>
        <img src='http://www.gravatar.com/avatar/81759b36bd906bbf803ce4a5ce84e643.png' />Joshua Chi
        <div>
        <a class="webicon twitter small" href="http://twitter.com/Joshua_C/">Twitter</a>
        <a class="webicon github small" href="https://github.com/joshuachi">Github</a>
        </div>
        <div class="colophon">
          <ul class="colophon-links">
            <li><a href="http://www.freetofeel.com/zh/">中文版本</a></li>
            <li><a href="http://www.freetofeel.com/google-calendar-hours/">Google calendar hours calculator</a></li>
            <li><a href='http://www.freetofeel.com/archives.html'> Archived posts</a>
            </li>
            <li><a href="http://freetofeel.com/atom.xml">Subscribe(xml)</a>
            </li>
          </ul>
          <p>Copyright &copy; 2016 Joshua Chi - Powered by <a href="http://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://github.com/">Github</a>
</p>
        </div>                
      </div>
    </header>

    <div class="content container">
      <div id="home">

<div class="post">
  <ul class="content">
		
			<div class="post" id="postid-/en/2011/07/02/iphone4-network-sharing-under-ubuntu">
				<a href="/en/2011/07/02/iphone4-network-sharing-under-ubuntu.html"><h1 class="title">Network Sharing Between Ubuntu And IPhone4(China Unicom Contract Version)</h1></a>
				
				<p>Find a solution from Internet that can make network sharing between Ubuntu And IPhone4.</p>

<pre>
sudo add-apt-repository ppa:pmcenery/ppa

sudo apt-get update

sudo apt-get install gvfs ipheth-dkms ipheth-utils
</pre>


<p>If you can pass all these steps, and then restart your machine. Bingo!</p>

<p>You can find more information <a href='http://ivkin.net/2010/05/tethering-ubuntu-lucid-lynx-and-iphone-os/#comment-4790' >here</a>.</p>


				<div class="post-metadata">
					July 02, 2011 | 
					<a href='/en/2011/07/02/iphone4-network-sharing-under-ubuntu.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#wifi'>wifi</a>
						, 
					
						
						<a href='/tags.html#ubuntu'>ubuntu</a>
						, 
					
						
						<a href='/tags.html#iphone4'>iphone4</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/06/22/get-commit-back-after-git-hard-reset">
				<a href="/en/2011/06/22/get-commit-back-after-git-hard-reset.html"><h1 class="title">Restore Lost Commits After Git Hard Reset</h1></a>
				
				<p>Sometimes, you will make mistakes. But when someone told you there still is a hope that if you try xxxxx. What feeling will you have?</p>

<p>The following might be one solution after 'git reset --hard' and realized you made a mistake:</p>

<pre>
  $ git reflog
  $ git merge 7c61179
</pre>


<p>Check the blog post <a href='http://gitready.com/advanced/2009/01/17/restoring-lost-commits.html'>here</a>.</p>


				<div class="post-metadata">
					June 22, 2011 | 
					<a href='/en/2011/06/22/get-commit-back-after-git-hard-reset.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#git'>git</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/06/12/nosql-db-try">
				<a href="/en/2011/06/12/nosql-db-try.html"><h1 class="title">Replace MySql Table with NoSQL DB</h1></a>
				
				<h4>Backgroud:</h4>


<p>I am not nosql fans. I don't have the habit to replace whole mysql db with nosql db. But if a mysql table can be replaced with nosql db and expensive queries are generated againest this table, I will give a try of nosql DB.</p>

<p>In our product, we have a unique user login log table to know how many users logined in a specify date. Here is the table structure:</p>

<pre>
  unique_login_logs: 
    _attributes:  {phpName: UniqueLoginLog}
    id:
    user_id: { type: integer }
    date: { type: date, index: true }
    created_at:
    _uniques:
      unique_date_type: [user_id, date]
</pre>


<p>The expensive query looks like:</p>

<pre>
select date, count(`user_id`) from unique_login_logs group by date order by date desc;'
</pre>


<p>And the other related operations will be save an entry into this table or check the user entry for a specify date is in the table or not. Nothing more.</p>

<h4>Choose NoSQL DB from <a href='http://en.wikipedia.org/wiki/NoSQL'>wiki page</a>: </h4>




<pre>
...
Key-value cache in RAM

    Citrusleaf database
    memcached
    Oracle Coherence
    Redis
    Tuple space
    Velocity

Key-value stores implementing the Paxos algorithm

    Keyspace

Key-value stores on disk

    BigTable
    CDB
    Citrusleaf database
    Dynomite
    Keyspace
    membase
    Memcachedb
    Redis
    Tokyo Cabinet
    TreapDB
    Tuple space
    MongoDB
...
</pre>


<p>For my feature request, I need a disk stored key-value system. I just spend 1 minute to take a look the MongoDB features. It meet my feature requirements. That's enough. If you know more about the other nosql DBs, of course you should choose the one which suit yours best.</p>

<h4>Try MongoDB</h4>


<p>Step 1: Install MongoDB(http://www.mongodb.org/display/DOCS/Quickstart+Unix);</p>

<p>Step 2: Simple demo testing:</p>

<p>create a new db:</p>

<pre>
use mydb;
</pre>


<p>Save an entry:</p>

<pre>
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 101});
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 111});
db.uniqueLoginLog.save({date: '2011-06-09', user_id: 102});
..
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 100});
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 101});
db.uniqueLoginLog.save({date: '2011-06-11', user_id: 102});
</pre>


<p>Group entries by date:</p>

<pre>
db.uniqueLoginLog.group(
           {key: { date:true },
            reduce: function(obj,prev) { prev.count ++; },
            initial: { count: 0 }
            });
            
</pre>


<p>The output looks like:</p>

<pre>
[
    {
        "date" : "2011-01-01",
        "count" : 3
    },
    {
        "date" : "2011-01-02",
        "count" : 3
    },
    {
        "date" : "2011-01-03",
        "count" : 1
    },
    {
        "date" : "2011-01-04",
        "count" : 1
    }
]
</pre>


<p></p>

<p>With the output, I can do the order in client.</p>

<h4>Install PHP Mongo Extension</h4>


<p>You can install Mongo PHP extension with pecl command line or install it <a href='http://pecl.php.net/package/mongo'>manually</a></p>

<pre>
> pecl search mongo
Retrieving data...0%
Matched packages, channel pecl.php.net:
=======================================
Package Stable/(Latest) Local
mongo   1.1.4 (stable)        MongoDB database driver

> pecl install mongo
</pre>




<h4>Get stored items with php function</h4>


<p>PHP code:</p>

<pre>
$m = new Mongo();

$db = $m->mydb;

$collection = $db->uniqueLoginLog;


$obj = array('date'=> '2011-06-09', 'user_id'=> 101);
$collection->insert($obj);



$keys = array("date" => 1);
$initial = array("count" => 0);
$reduce = "function(obj,prev) { prev.count ++; }";
$g = $collection->group($keys, $initial, $reduce);

var_dump($g);

</pre>


<p>Output looks like:</p>

<pre>
array(4) {
  ["retval"]=>
  array(3) {
    [0]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-09"
      ["count"]=>
      float(17)
    }
    [1]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-11"
      ["count"]=>
      float(10)
    }
    [2]=>
    array(2) {
      ["date"]=>
      string(10) "2011-06-10"
      ["count"]=>
      float(7)
    }
  }
  ["count"]=>
  float(34)
  ["keys"]=>
  int(3)
  ["ok"]=>
  float(1)
}
</pre>




<h4>Deploy to production?</h4>


<p>Until now, the demo is still a toy. If you want to deploy it to production, there are more work need to to be done. Take a look at the <a href='http://www.mongodb.org/display/DOCS/Admin+Zone'>admin zone</a></p>

<p>For my feature implemention, I will consider <a href='http://www.mongodb.org/display/DOCS/Replication'>Replication</a> next step.</p>

<p>Summary:</p>

<p>This is not a <a href='http://www.mongodb.org/display/DOCS/Tutorial'>toturial</a> about how to use MongoDB. It is just a example that can use nosql db in your production.</p>

<p>Reference:</p>

<ul>
<li><a href='http://try.mongodb.org/'>A Tiny MongoDB Browser Shell (mini tutorial included)</a></li>
<li><a href='https://github.com/mongodb/mongo/tree/master/jstests/'>JsTest</a></li>
</ul>



				<div class="post-metadata">
					June 12, 2011 | 
					<a href='/en/2011/06/12/nosql-db-try.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#mysql'>mysql</a>
						, 
					
						
						<a href='/tags.html#nosql'>nosql</a>
						, 
					
						
						<a href='/tags.html#mongodb'>mongodb</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/05/24/mysql-index-merge">
				<a href="/en/2011/05/24/mysql-index-merge.html"><h1 class="title">When To Use Combine Index</h1></a>
				
				<p>There are already a lot of posts which gave a introduction of what index merge is in MySQL. One of them is:</p>

<p><a href='http://brian.moonspot.net/2008/04/22/playing-with-mysql-index-merge/'>Playing with MySQL's index merge</a></p>

<p>Today I just noticed the combined index also can be affected by the single column index. For example:</p>

<ol>
<li>Let's say we have a table named table1 which have 100,000 items. The size of this table is 35MB.</li>
</ol>


<p>Table structure:</p>

<pre>
CREATE TABLE `table1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `status1` int(11) DEFAULT NULL,
  `status2` int(11) DEFAULT NULL,
  `status3` int(11) DEFAULT NULL,
  `status4` int(11) DEFAULT NULL,
  `status5` int(11) DEFAULT NULL,
  `status6` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `table1_name_unique` (`name`),
  KEY `table1_status1` (`status1`),
  KEY `table1_status2` (`status2`),
  KEY `table1_status3` (`status3`),
  KEY `table1_status4` (`status4`),
  KEY `table1_status5` (`status5`),
  KEY `table1_status6` (`status6`),
  KEY `table1_combine_index` (`status1`,`status2`,`status3`,`status4`,`status5`,`status6``)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</pre>


<p>We have a query need to select items from table1 table with checking all the status columns in where clause. Let's do a explain:</p>

<pre>
explain select * from table1 where status1=1 and status2=1 and status3=1 and status4=1 and status5=1 and status6=1  
</pre>


<p>Explain result:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: index_merge
  possible_keys: PRIMARY,table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6,table1_combine_index
  key: table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6
  key_len: 1,1,4,4,4,5
  refs: NULL
  rows: 1955
  Extra: Using intersect(table1_status1,table1_status2,table1_status3,table1_status4,table1_status5,table1_status6); Using where
</pre>


<p>The select query takes <b>3.5ms</b> by intersecting indexes.</p>

<p>What happened if we force index to use table1_combine_index:</p>

<pre>
explain select * from table1 force index (table1_combine_index)  where status1=1 and status2=1 and status3=1 and status4=1 and status5=1 and status6=1  
</pre>


<p>Explain result:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: ref
  possible_keys: table1_combine_index
  key: table1_combine_index
  key_len: 9
  refs: const,const
  rows: 62590
  Extra: Using where
</pre>


<p>The select query takes <b>10.5ms</b> by using combine index.</p>

<p>In this example, intersecting index is more useful than combine index. There is an article give a more detailed explanation why it works like this:</p>

<p><a href='http://www.mysqlperformanceblog.com/2009/09/19/multi-column-indexes-vs-index-merge/'>Multi Column indexes vs Index Merge</a></p>

<ol>
<li>Now it's time to make this example a little complicated.</li>
</ol>


<p>We have another table named table2, the structure looks like:</p>

<pre>
CREATE TABLE `table2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `table1_id` int(11) NOT NULL,
  `column1` datetime NOT NULL,
  `column2` varchar(255) NOT NULL,
  `column3` text,
  `column4` tinyint(4) NOT NULL,
  `column5 ` tinyint(4) NOT NULL,
  `column6 ` tinyint(4) NOT NULL,
  `column7` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `column7 ` (`column7 `),
  KEY `table2_FI_1` (`table1_id `)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</pre>


<p>There are 20,000 rows in table2, with size 11MB. We have a feature request need to join table1 with table2 and sort by table2's id.</p>

<pre>
SELECT sql_no_cache * FROM table2 LEFT JOIN table1 ON (table2.table1_id = table1.id) WHERE table1.status1=1 and table1.status2=1 and table1.status3=1 and table1.status4=1 and table1.status5=1 and table1.status6=1 ORDER BY table2.id DESC LIMIT 10;
</pre>


<p>It takes <b>3s</b> to finish the query. The explain tells you:</p>

<pre>
  select_type: SIMPLE
  table: table1
  type: index_merge
  possible_keys: PRIMARY,`table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`,`table1_combine_index`
  key: `table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`
  key_len: 1,1,4,4,4,5
  refs: NULL
  rows: 1955
  Extra: Using intersect(`table1_status1`,`table1_status2`,`table1_status3`,`table1_status4`,`table1_status5`,`table1_status6`); Using where
  
  ---
  select_type: SIMPLE
  table: table2
  type: ref
  possible_keys: table2_FI_1
  key: table2_FI_1
  key_len: 4
  refs: table1.id
  rows: 1
  Extra:  
</pre>


<p>Now I want to remove these single column indexes in table1 to see what will happen:</p>

<pre>
  select_type: SIMPLE
  table: table2
  type: index
  possible_keys: table2_FI_1
  key: PRIMARY
  key_len: 4
  refs: 
  rows: 10
  Extra:
  
  ---
  
  select_type: SIMPLE
  table: table1
  type: eq_ref
  possible_keys: PRIMARY,table1_combine_index
  key: PRIMARY
  key_len: 4
  refs: table2.table1_id
  rows: 1
  Extra: Using where
</pre>


<p>After removing the single column indexes in table 1, this select query only takes <b>2.4ms</b>. To explain this, we can simply treat (status1,status2,status3,status4,status5,status6) as one column in table1. I think the single columns indexes affected the 'join' performance. MySQL need to use these single indexes to filter the table1 firstly and then make a join with table2.</p>

<p>Summary:</p>

<p>Combine index is not always better than index merge. To know which one is better, explain your query, analyze it and adjust the index.</p>


				<div class="post-metadata">
					May 24, 2011 | 
					<a href='/en/2011/05/24/mysql-index-merge.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#mysql'>mysql</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/05/06/upgrade-ubuntu-fpm-404-error">
				<a href="/en/2011/05/06/upgrade-ubuntu-fpm-404-error.html"><h1 class="title">Nginx, PHP-FPM, 404 error after upgrading to Ubuntu 11.04</h1></a>
				
				<p>After upgrading from ubuntu 10.10 to ubuntu 11.04 my local site didn't work anymore. It reponsed with a 404 page.</p>

<p>After researcing for a while, I found the root should be put outside the location property:
Before:</p>

<pre>
server {
  server_name  localhost;

  location / {
        root   /var/www;
        index  index.php index.html index.htm;
    }
 ....
}

</pre>


<p>After:</p>

<pre>
server {

  root   /var/www;
  index  index.php index.html index.htm;
  server_name  localhost;

 ....
}
</pre>


<p>Now it works, but have no idea what has been changed since Ubuntu upgrade.</p>


				<div class="post-metadata">
					May 06, 2011 | 
					<a href='/en/2011/05/06/upgrade-ubuntu-fpm-404-error.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#ubuntu'>ubuntu</a>
						, 
					
						
						<a href='/tags.html#php-fpm'>php-fpm</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/05/01/solve-ubuntu1104-wifi-issue">
				<a href="/en/2011/05/01/solve-ubuntu1104-wifi-issue.html"><h1 class="title">Solve Wireless Issue When Upgrading From 10.10 to 11.04</h1></a>
				
				<p>After upgrading from ubuntu 10.10 to ubuntu 11.04 the wireless stop working.</p>

<p>The first step, I was using <a href="https://help.ubuntu.com/community/WifiDocs/WirelessTroubleShootingGuide">ubuntu trouble shooting</a> to detect the issue.</p>

<ol type="a">
<li>Detail whether there are software or hardware blocks on your rf devices. To get a list of devices and their hardware and software status, try "sudo rfkill list".</li>
</ol>


<pre>
~$ sudo rfkill list
0: hp-wifi: Wireless LAN
    Soft blocked: yes
    Hard blocked: yes
</pre>


<p>Unblock your devices by "sudo rfkill unblock 0".</p>

<ol type="a">
<li>Check for Device Recognition for my HP laptop(amd64)</li>
</ol>


<pre>
~$ sudo lshw -C network
  *-network UNCLAIMED     
       description: Network controller
       product: BCM4311 802.11a/b/g
       vendor: Broadcom Corporation
       physical id: 0
       bus info: pci@0000:30:00.0
       version: 01
       width: 32 bits
       clock: 33MHz
       capabilities: pm msi pciexpress bus_master cap_list
       configuration: latency=0
       resources: memory:c8000000-c8003fff
  *-network
       description: Ethernet interface
       product: NetXtreme BCM5788 Gigabit Ethernet
       vendor: Broadcom Corporation
       physical id: 1
       bus info: pci@0000:02:01.0
       logical name: eth0
       version: 03
       serial: 00:17:08:37:6a:64
       size: 100Mbit/s
       capacity: 1Gbit/s
       width: 32 bits
       clock: 66MHz
       capabilities: pm vpd msi bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt 1000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=tg3 driverversion=3.116 duplex=full firmware=5788-v3.26 ip=192.168.1.103 latency=64 link=yes mingnt=64 multicast=yes port=twisted pair speed=100Mbit/s
       resources: irq:23 memory:d4000000-d400ffff
</pre>


<p>Here I can see 'tg3' driver was using. And by checking the loaded module the tg3 is there.</p>

<pre>
~$ sudo lsmod
</pre>


<p>If your driver was not loaded, you can load it by "sudo modprobe <module>"</p>

<ol type="a">
<li>Identify PCI devices with PCI ID.</li>
</ol>


<pre>
~$ sudo lspci -v | grep Ethernet
02:01.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5788 Gigabit Ethernet (rev 03)

~$ sudo lspci -v | grep Network
30:00.0 Network controller: Broadcom Corporation BCM4311 802.11a/b/g (rev 01)
</pre>


<ol type="a">
<li>Check the addtional drivers, I found "Broadcom STA wireless driver" was using.</li>
</ol>


<p>Everything looks good until now. Driver was working and was recognized. So I guess the issue might be the compatibility with new kernel?</p>

<ol type="a">
<li>With the help from google.</li>
</ol>


<p>i). Someone solve it by install <a herf="http://ubuntuforums.org/showthread.php?t=1653157">linux-backports-modules-wireless-maverick-generic</a>. It is interesting to know what <a hef="https://help.ubuntu.com/community/UbuntuBackports">backports</a> is.</p>

<p>Unfortunately it didn't work for me.</p>

<p>ii). So I tried the solution in this <a href="http://ubuntuforums.org/showthread.php?t=1653157&page=2">thread</a> by disable my "Broadcom STA wireless driver" and install b43.</p>

<pre>
Removing "bcmwl-kernel-source" by using Synaptic Package Manager
Then installing "firmware-b43-installer" and "b43-fwcutter" again by Synaptic Package Manager. 
</pre>


<p>At the end of step e, and by rebooting laptop, the wifi issue was fixed. If you still has the issue, I suggest check the trouble shooting tutorial again. It is really helpful.</p>

<p>Reference:</p>

<p>1.http://linuxfans.keryxproject.org/?page_id=27</p>

<p>2.http://www.ubuntumini.com/2009/11/broadcom-wireless-driver-fix-in-karmic.html</p>


				<div class="post-metadata">
					May 01, 2011 | 
					<a href='/en/2011/05/01/solve-ubuntu1104-wifi-issue.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#ubuntu'>ubuntu</a>
						, 
					
						
						<a href='/tags.html#wireless'>wireless</a>
						
					 
				</div>

			</div>
		
			<div class="post" id="postid-/en/2011/04/22/what-rabbitmq-cluster-can-do">
				<a href="/en/2011/04/22/what-rabbitmq-cluster-can-do.html"><h1 class="title">What RabbitMQ Cluster Can Do</h1></a>
				
				<h3>What RabbitMQ cluster can do - Scaling and Reliability</h3>

<ul>
<li><b>Example 1</b>:</li>
</ul>


<p>All data/state required for the operation of a RabbitMQ broker is replicated across all nodes.</p>

<p>Let's take an example to help you understand better.</p>

<p>There is a publisher which publish 10 messages to RabbitMQ broker(*1).</p>

<p>|Publisher| --> |10 Messages| --> |Broker( = Node_A + Node_B)|</p>

<p>So Node_A will receive Message 1, Message 3, 5, 7, 9; Node_B will receive Message 2, Message 4, 6, 8, 10.</p>

<ul>
<li><b>Example 2</b>:</li>
</ul>


<p>We still use the above example. If the Node_A crashed when it is consuming the messages, what happens?</p>

<p>Before Node_A crashed (I simply powered off this machine):</p>

<p>Node_A finished Message 1, Message 3, and it is starting to consume Message 5;</p>

<p>Node_B finished Message 2, Message 4 and it is starting to consume Message 6.</p>

<p>After Node_A crashed:</p>

<p>Node_A stopped working;</p>

<p>Node_B finished Message 6, Message 7, Message 8, Message 9, Message 10 and Message 5.</p>

<p>Yes, as you can see, even Node_A dies unexpected. Broker still can get the status of Message 5 and send it to Node_B.
And you can find following explanation:</p>

<pre>
  If a node goes down or becomes unreachable what effects can this have on the cluster? Do things 'hang' for a bit?
  
  Topology change operations (see above) could potentially pause operation for a brief time but they will complete eventually. We use the net_kernel erlang module to do monitoring between nodes. The default "tick" time there is 60 seconds but this can be reduced. Further, in the event of a failure, any communication between the nodes will likely result in an error being generated and detected immediately: i.e. the only time at which you would not know about a node failure for 60 seconds is if there was no communication between the nodes for that amount of time.
  
  ....
  
</pre>


<h3>What RabbitMQ cluster can not do - High Availability</h3>

<p>So the 60 seconds is what RabbitMQ can not do. We call it high availability.</p>

<pre>
...
Whilst RabbitMQ also supports clustering, clustering is intended to facilitate scalability, not availability. Thus in a cluster, if a node fails, queues which were on the failed node are lost. With the high availability setup described in this guide, when a node fails, the durable queues and the persistent messages within them can be recovered by a different node.
...
</pre>


<p>To build a high availability and scalable application, you can take a look <a href='http://www.rabbitmq.com/pacemaker.html'>RabbitMQ Placemaker</a></p>

<p>References:</p>

<ol>
<li>RabbitMQ broker - a logical grouping of one or several Erlang nodes, each running the RabbitMQ application and sharing users, virtual hosts, queues, exchanges, etc. Sometimes we refer to the collection of nodes as a cluster.</li>
</ol>



				<div class="post-metadata">
					April 22, 2011 | 
					<a href='/en/2011/04/22/what-rabbitmq-cluster-can-do.html#disqus_thread'>View Comments</a>
					
						
							| 
						
						<a href='/tags.html#rabbitmq'>rabbitmq</a>
						
					 
				</div>

			</div>
		
		
		<div class="paging">
		
			<a href="/page3" class="previous">&#x25C4; Previous</a>
		
		
			
			  <a href="/" class="next">Next &#x25BA;</a>
			
		
		</div>

  </ul>
</div>
</div>

    </div>

  </body>
</html>
